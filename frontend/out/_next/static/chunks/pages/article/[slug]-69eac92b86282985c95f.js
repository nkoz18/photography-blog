(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[894],{5030:function(t,e,a){"use strict";var r=a(5893),n=a(7757),i=a.n(n),o=a(2137),l=a(7294),s=a(1422);e.Z=function(t){var e,a,n,c=t.image,u=(t.style,t.alt),d=(0,l.useState)(!0),f=d[0],g=d[1],m=(0,l.useState)(""),p=m[0],v=m[1],h=(0,l.useState)(!1),b=h[0],x=h[1],y=(0,l.useState)(0),k=y[0],w=y[1],j=(0,l.useRef)(null);(0,l.useEffect)((function(){var t;if(null!==c&&void 0!==c&&null!==(t=c.data)&&void 0!==t&&t.attributes){var e=(0,s.$0)(c);v(e),w(0)}return function(){p&&p.startsWith("blob:")&&URL.revokeObjectURL(p)}}),[c,p]);var _=function(){var t=(0,o.Z)(i().mark((function t(e){var a,r;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e,{method:"GET",headers:{"Cache-Control":"no-cache"}});case 3:if(!(a=t.sent).ok){t.next=9;break}return t.next=7,a.blob();case 7:return r=t.sent,t.abrupt("return",URL.createObjectURL(r));case 9:throw new Error("HTTP ".concat(a.status));case 12:return t.prev=12,t.t0=t.catch(0),console.error("Fetch preload failed:",t.t0),t.abrupt("return",null);case 16:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(e){return t.apply(this,arguments)}}();if(null===c||void 0===c||null===(e=c.data)||void 0===e||!e.attributes)return null;var P=c.data.attributes.alternativeText,N=(null===c||void 0===c||null===(a=c.data)||void 0===a||null===(n=a.attributes)||void 0===n?void 0:n.width)>1e3,E=u||P||"";return(0,r.jsxs)("div",{className:"image-container ".concat(N?"article-cover-image-container":""),style:{position:"relative",width:"100%",height:"auto",maxWidth:"100%"},children:[f&&!N&&(0,r.jsx)("div",{style:{width:"100%",paddingBottom:"56.25%",backgroundColor:"#f5f5f5",backgroundImage:"url('/loader.gif')",backgroundRepeat:"no-repeat",backgroundPosition:"center center",backgroundSize:"50px 50px"}}),f&&N&&(0,r.jsx)("div",{className:"image-loader"}),b&&(0,r.jsx)("div",{className:"image-error",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"#999",fontSize:"14px"},children:"Image failed to load"}),p&&!b&&(0,r.jsx)("img",{ref:j,src:p,alt:E,className:"image-transition ".concat(f?"image-loading":"image-loaded"),onLoad:function(){g(!1),x(!1);var t=function(){var t,e,a;if(null===c||void 0===c||null===(t=c.data)||void 0===t||!t.attributes)return null;var r=c.data.attributes,n=null;return null!==(e=r.provider_metadata)&&void 0!==e&&e.focalPoint?n=r.provider_metadata.focalPoint:null!==(a=r.formats)&&void 0!==a&&a.focalPoint?n=r.formats.focalPoint:r.focalPoint&&(n=r.focalPoint),n&&"number"===typeof n.x&&"number"===typeof n.y?{x:Math.max(0,Math.min(100,n.x)),y:Math.max(0,Math.min(100,n.y))}:null}();if(t&&j.current&&N){var e="".concat(t.x,"% ").concat(t.y,"%");j.current.style.setProperty("--focal-point",e);var a=j.current.getBoundingClientRect();console.log("Applied focal point: ".concat(e)),console.log("Image dimensions: ".concat(a.width,"x").concat(a.height)),console.log("Window dimensions: ".concat(window.innerWidth,"x").concat(window.innerHeight)),console.log("Is mobile viewport:",window.innerWidth<=768)}},onError:function(){var t=(0,o.Z)(i().mark((function t(e){var a,r;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.error("Image failed to load:",p,e),g(!1),!(k<3)){t.next=17;break}return console.log("Retry attempt ".concat(k+1,"/3 for:"),p),t.next=6,_(p);case 6:if(!(a=t.sent)){t.next=13;break}return console.log("Using blob URL:",a),v(a),w(k+1),g(!0),t.abrupt("return");case 13:r="".concat(p.split("?")[0],"?t=").concat(Date.now(),"&retry=").concat(k+1),setTimeout((function(){v(r),w(k+1),g(!0)}),1e3*(k+1)),t.next=18;break;case 17:x(!0);case 18:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),style:N?{width:"100%",maxWidth:"100%",display:"block",objectFit:"cover"}:{width:"100%",height:"auto",maxWidth:"100%",display:"block"}})]})}},6612:function(t,e,a){"use strict";a.r(e),a.d(e,{__N_SSG:function(){return x}});var r=a(5893),n=a(7757),i=a.n(n),o=a(3391),l=a(2137),s=a(724),c=a.n(s),u=a(883),d=a(6415),f=a(5030),g=a(8303),m=a(5152),p=(a(1422),a(7294)),v=a(1163),h=a(4155),b=(0,m.default)((function(){return Promise.all([a.e(687),a.e(474),a.e(249)]).then(a.bind(a,3899))}),{ssr:!1,loadableGenerated:{webpack:function(){return[3899]},modules:["article/[slug].js -> ../../components/PhotoSwipeGallery"]}}),x=!0;e.default=function(t){var e,a,n=t.article,s=t.categories,m=(0,v.useRouter)(),x=(0,p.useState)(n),y=x[0],k=x[1],w=(0,p.useState)(!1),j=w[0],_=w[1],P=(0,p.useState)(!1),N=P[0],E=P[1];if((0,p.useEffect)((function(){var t,e,a,r,n,i,o,l,s;if(null!==y&&void 0!==y&&y.attributes){console.log("Article data structure:",y),y.attributes.gallery&&console.log("Article gallery:",y.attributes.gallery),y.attributes.images&&console.log("Article images:",y.attributes.images),console.log("Complete image data:",null===(t=y.attributes.image)||void 0===t||null===(e=t.data)||void 0===e?void 0:e.attributes),null!==(a=y.attributes.image)&&void 0!==a&&null!==(r=a.data)&&void 0!==r&&null!==(n=r.attributes)&&void 0!==n&&n.provider_metadata&&console.log("Provider metadata:",y.attributes.image.data.attributes.provider_metadata);var c=null===(i=y.attributes.image)||void 0===i||null===(o=i.data)||void 0===o?void 0:o.attributes,u=null;null!==c&&void 0!==c&&null!==(l=c.formats)&&void 0!==l&&l.focalPoint?(u=c.formats.focalPoint,console.log("Found focal point in formats:",u)):null!==c&&void 0!==c&&null!==(s=c.provider_metadata)&&void 0!==s&&s.focalPoint?(u=c.provider_metadata.focalPoint,console.log("Found focal point in provider_metadata:",u),c.formats||(c.formats={}),c.formats.focalPoint=u):null!==c&&void 0!==c&&c.focalPoint&&(u=c.focalPoint,console.log("Found focal point as direct property:",u)),u?(console.log("Focal point data:",u),console.log("Image will use focal point positioning at:","".concat(u.x,"% ").concat(u.y,"%"))):console.log("No focal point data found for the featured image")}}),[y]),(0,p.useEffect)((function(){(function(){var t=(0,l.Z)(i().mark((function t(){var e,a,r,n,l,s,c,d,f,g;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(m.query.slug){t.next=2;break}return t.abrupt("return");case 2:if(_(!0),t.prev=3,a=m.query.slug,r=a.includes("~"),E(r),!r){t.next=23;break}return n=a.split("~"),l=(0,o.Z)(n,2),s=l[0],c=l[1],d="true"===h.env.USE_CLOUD_BACKEND?"https://api.silkytruth.com":"http://localhost:1337",t.next=12,fetch("".concat(d,"/api/articles/by-token/").concat(s,"/").concat(c));case 12:if(!(f=t.sent).ok){t.next=20;break}return t.next=16,f.json();case 16:g=t.sent,e={data:[g.data]},t.next=21;break;case 20:throw new Error("Article not found or invalid token");case 21:t.next=26;break;case 23:return t.next=25,(0,u.I)("/articles",{filters:{slug:a,publishedAt:{$notNull:!0}},populate:{image:{fields:["url","alternativeText","caption","width","height","formats","provider_metadata"]},images:{fields:["url","alternativeText","caption","width","height","formats","provider_metadata"]},gallery:{populate:{gallery_items:{populate:{image:{fields:["url","alternativeText","caption","width","height","formats","provider_metadata"]}}}}},author:{populate:{picture:{fields:["url"]}}},categories:{fields:["name","slug"]}}});case 25:e=t.sent;case 26:if(!(e&&e.data&&e.data.length>0)){t.next=31;break}console.log("Fetched fresh article data:",e.data[0]),k(e.data[0]),t.next=33;break;case 31:if(!r){t.next=33;break}throw new Error("Invalid token or article not found");case 33:t.next=41;break;case 35:if(t.prev=35,t.t0=t.catch(3),console.error("Error fetching fresh article data:",t.t0),!N){t.next=41;break}return m.replace("/404"),t.abrupt("return");case 41:return t.prev=41,_(!1),t.finish(41);case 44:case"end":return t.stop()}}),t,null,[[3,35,41,44]])})));return function(){return t.apply(this,arguments)}})()()}),[m.query.slug,n,m]),!n&&!y)return m.query.slug&&m.query.slug.includes("~")?(0,r.jsx)(d.Z,{categories:s||[],children:(0,r.jsx)("div",{className:"uk-section",children:(0,r.jsx)("div",{className:"uk-container uk-container-large",children:(0,r.jsx)("div",{style:{textAlign:"center",padding:"4rem 0"},children:(0,r.jsx)("p",{children:"Loading article..."})})})})}):(0,r.jsx)("div",{children:"Loading..."});var L=m.query.slug&&m.query.slug.includes("~"),S=!(null===y||void 0===y||!y.attributes)&&!y.attributes.publishedAt,A=L&&null!==y&&void 0!==y&&y.attributes?"https://www.silkytruth.com/article/".concat(y.attributes.slug):null,T=null!==y&&void 0!==y&&y.attributes?{metaTitle:y.attributes.title,metaDescription:y.attributes.description,shareImage:y.attributes.image,article:!0,isPreview:L,noindex:S&&!L,canonicalUrl:A}:{metaTitle:"Loading...",metaDescription:"Loading article content...",noindex:!0};return(0,r.jsxs)(d.Z,{categories:s,children:[(0,r.jsx)(g.Z,{seo:T}),(0,r.jsx)("div",{className:"uk-section",children:(0,r.jsx)("div",{className:"uk-container uk-container-large",children:null!==y&&void 0!==y&&y.attributes?(0,r.jsxs)(r.Fragment,{children:[y.attributes.image&&(0,r.jsx)("div",{className:"article-cover-image",style:{marginBottom:"2rem",maxWidth:"100%",overflow:"hidden",minHeight:"300px"},children:(0,r.jsx)(f.Z,{image:y.attributes.image,alt:y.attributes.title||"Article featured image"})}),(0,r.jsx)("h1",{className:"uk-article-title",children:y.attributes.title}),(null===(e=y.attributes.author)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.attributes)&&(0,r.jsxs)("p",{className:"article-author",children:["by ",y.attributes.author.data.attributes.name]}),(0,r.jsx)("div",{className:"uk-article-content",children:(0,r.jsx)(c(),{source:y.attributes.content,escapeHtml:!1})}),j?(0,r.jsx)("div",{style:{textAlign:"center",padding:"2rem"},children:(0,r.jsx)("p",{children:"Loading latest gallery content..."})}):(0,r.jsx)(b,{galleryData:y.attributes.gallery,images:y.attributes.images})]}):(0,r.jsx)("div",{style:{textAlign:"center",padding:"4rem 0"},children:(0,r.jsx)("p",{children:"Loading article content..."})})})})]})}},615:function(t,e,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/article/[slug]",function(){return a(6612)}])}},function(t){t.O(0,[774,796,751,888,179],(function(){return e=615,t(t.s=e);var e}));var e=t.O();_N_E=e}]);